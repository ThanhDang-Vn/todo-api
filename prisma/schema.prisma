generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Card {
  id          String    @id @default(uuid()) @db.Uuid
  title       String    @db.VarChar
  description String    @db.VarChar
  priority    String    @db.VarChar
  order       Int       @default(0)
  dueTo       DateTime  @db.Timestamp(6) @map("due_to")
  createdAt   DateTime  @default(now()) @db.Timestamp(6) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  completeAt  DateTime? @db.Timestamp(6) @map("complete_at")
  
  reminders   Reminder[]
  
  columnId    String?   @db.Uuid
  column      Column?   @relation(fields: [columnId], references: [id], onDelete: Cascade)

  @@map("cards")
}

model Column {
  id        String   @id @default(uuid()) @db.Uuid
  title     String   @db.VarChar
  order     Int      @default(0)
  createdAt DateTime @default(now()) @db.Timestamp(6) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  
  userId    String?  @db.Uuid
  cards     Card[]
  user      User?    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("columns")
}

model User {
  id                 String   @id @default(uuid()) @db.Uuid
  firstName          String   @db.VarChar @map("first_name")
  lastName           String   @db.VarChar @map("last_name")
  email              String   @unique @db.VarChar
  password           String   @db.VarChar
  hashedRefreshToken String?  @db.VarChar @map("hashed_refresh_token")
  avatarUrl          String?  @db.VarChar @map("avatar_url")
  createdAt          DateTime @default(now()) @db.Timestamp(6) @map("created_at")
  role               Role     @default(USER)
  
  columns            Column[]

  @@map("users")
}

model Reminder {
  id        String   @id @default(uuid()) @db.Uuid
  cardId    String   @db.Uuid @map("card_id")
  remindAt  DateTime @db.Timestamp(6) @map("remind_at")
  isSent    Boolean  @default(false) @map("is_sent")
  createdAt DateTime @default(now()) @db.Timestamp(6) @map("created_at")
  
  card      Card     @relation(fields: [cardId], references: [id], onDelete: Cascade)

  @@map("reminders")
}

model PasswordResetToken {
  id        String   @id @default(uuid()) @db.Uuid
  email     String   @unique @db.VarChar 
  token     String   @db.VarChar
  expiresAt DateTime @map("expires_at")
  createdAt DateTime @default(now()) @map("created_at")

  @@map("password_reset_tokens")
}

enum Role {
  ADMIN
  USER
  EDITOR
}